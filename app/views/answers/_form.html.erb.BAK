<%= form_for @patient, url: patients_path(@patient), method: :post do |f| %>
    <% count=1%>
    <%= f.fields_for :answers do |builder| %>
        <%q = IntroductionQuestion.where(:idQuestion =>  count).limit(1).first  %>

        <% if q.tag.match(/[a-z]+/) %><% style='margin-left: 30px;'%><%else%><% style=''%><% end %>

        <div class="field"  style="<%=style%>">
            <%= q.tag %> <%= q.question %>
            <% if q.has_comment %>
                <% tmp = count-1 %>
                <% if q.tag != '' %>
                    <p><%= builder.check_box :presence  %> Oui</p>
                    <% tmp += 1 %>
                <% end %>

                <div id='area<%=tmp.to_s%>' >
                    <!-- change attribut presence of current answer, beacause it is not showed -->
                    <p><%= builder.text_area :response %></p>
                </div>
            <% else %>
                <p><%= builder.check_box :presence  %> Oui</p>
            <% end %>
            <% count += 1 %>
        </div>
    <% end %>

    <%= f.submit 'Submit'%>
<% end %>

<script>

    var allInputs = document.getElementsByTagName("input");
    for (var i = 0, max = allInputs.length; i < max; i++){
        if (allInputs[i].type === 'checkbox')
            allInputs[i].addEventListener('click', ev_button_change, false);
    }
    function ev_button_change (ev) {
        var a =parseInt(ev.target.id.split("_")[3]);
        a +=1;
        if(ev.target.checked){
            $("#area"+a).show(300);
        }else
            $("#area"+a).hide(300);
    }
</script>